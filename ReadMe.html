
<!DOCTYPE HTML>
<html>
<head>
<title>PHP Contact Us Script by NewPast - Read Me</title>
<link rel="stylesheet" type="text/css" href="styles.css" />
</head>
<body>
<!--
HTML for article "PHP Contact Us Script" by NewPast
URL: https://www.codeproject.com/KB/PHP/1139299.aspx
Copyright 2016 by NewPast
All formatting, additions and alterations Copyright Â© CodeProject, 1999-2017
-->
<h1>PHP Contact Us Script by NewPast - Read Me</h1>
<h2>Web Development >> PHP</h2>


<h2>Tagged as</h2>
<p>HTML, PHP, hosting, website, Web</p>




<h2>Introduction</h2>

<p>Run out of box PHP contact us script, It does not need modification, it will detect the domain and send email containing the contact message to info@yourdomain. Whatever fields are in your form will be detected and be sent with email.</p>

<h2>Background</h2>

<p>Lots of contact us scripts are available over the internet. To use any other script, the modification of the PHP file is needed.</p>

<p>This script is very useful to those who do not know PHP and to the beginners of PHP.</p>

<h2>Using the Code</h2>

<p>Upload the <em>script</em> folder to your www root directory.</p>

<h4>From Action</h4>

<pre lang="html">&lt;form action="contact2us/send.php" method="POST"&gt;</pre>

<h4>Fields Names</h4>

<div>Use <code>from_email</code>, <code>from_name</code>, <code>subject</code>, <code>message</code> and <code>captcha</code> as main fields' names in your form.</div>

<h4>Captcha</h4>

<div>If you don't wish to use captcha, then no change is needed and the 1<sup>st</sup> line of code will be:</div>

<pre lang="php">$captcha = false;</pre>

<div>If you wish to use captcha, then change the 1<sup>st</sup> line of code to be:</div>

<pre lang="php">$captcha = true;</pre>

<p>To use captcha, include the following in your form:</p>

<pre lang="php">&lt;img src="contact2us/captcha_code_file.php?rand=&lt;?php echo rand(); 
?&gt;" id='captchaimg' &gt;&lt;br&gt;

Enter the code above here : &lt;input id="captcha" 
name="captcha" type="text"&gt;&lt;br&gt;</pre>

<h4>Thank you url</h4>

<p>Put your own <code>$thank_you_url</code> in the 2<sup>nd</sup> line of the code.</p>

<h2>What Does This Script Do?</h2>

<ul>
	<li>Check the referrer page and stop the script if it is called directly:
	<pre lang="php">$REFERER = $_SERVER['HTTP_REFERER'];
if(!preg_match("@^http:\/\/(www\.)?$domain\/@",$REFERER)){
                die("This page can't be call directly");
}</pre>
	</li>
	<li>Validate user email and user name to prevent injecting wrong command in the header parameter of the mail function:
	<pre lang="php">if(!$from_email) $from_email = "web_page@$domain";
if (!filter_var($from_email, FILTER_VALIDATE_EMAIL)) {
                $Err .= 'Invalid email format&lt;br&gt;';
                $from_email = "web_page@$domain";
}</pre>
	</li>
	<li>Validate subject and encode it if needed to prevent send failure:
	<pre lang="php">if ($subject &amp;&amp; !preg_match('/^[A-Za-z ]+$/',$subject)){
                $subject = "=?UTF-8?B?".base64_encode($subject)."?=";
}</pre>
	</li>
	<li>Store captcha in session and compare it with variable</li>
	<li>Seek all posted variables
	<pre lang="php">foreach ($_POST as $key =&gt; $value)
{
    $value = htmlspecialchars($value);
    $message_html .= "&lt;h2&gt;$key&lt;/h2&gt;&lt;p&gt;$value&lt;/p&gt;";
}</pre>
	</li>
	<li>Send the message in html utf-8 format to be compatible with most languages</li>
	<li>Redirect to thank you URL
	<pre lang="php">header('Location: '. $thank_you_url);</pre>
	</li>
</ul>

<h2>PHP Mailing Technique</h2>

<p>There are many mailing technique in PHP; PEAR Mail, PHP Mailer and mail function. However we just use mail function as it is old, common and simple.</p>

<h2>PHP Email Validation</h2>

<h4>PHP FILTER_SANITIZE_EMAIL Filter</h4>

<p>Remove all illegal characters from an email address:</p>

<pre lang="php">$from_email = filter_var($from_email, FILTER_SANITIZE_EMAIL);</pre>

<h4>PHP FILTER_VALIDATE_EMAIL Filter</h4>

<p>Check if the variable $email is a valid email address:</p>

<pre>if (!filter_var($from_email, FILTER_VALIDATE_EMAIL)) {                    
    $Err .= 'Invalid email format&lt;br&gt;';               
    $from_email = "web_page@$domain";
}</pre>

<h4>Validate email in PHP using regular expression:</h4>

<pre lang="php">$pattern = '/^[\w.-]+@[\w.-]+\.[A-Za-z]{2,6}$/';
if(!preg_match($pattern, $from_email)){ 
    $Err .= 'Invalid email format&lt;br&gt;';               
    $from_email = "web_page@$domain";
}</pre>

<h2>What is the Next Step?</h2>

<p>Setting the max email could be sent for a single IP per hour.</p>

<p>If you have any suggestion to this section or to improve the script; please write it in the comments to be included in the next version.</p>


</body>
</html>
